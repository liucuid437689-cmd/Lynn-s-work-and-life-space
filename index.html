<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>My Life OS V6.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #f2f2f7;
            --card-bg: #ffffff;
            --text-main: #1c1c1e;
            --text-sub: #8e8e93;
            --accent-blue: #007aff;
            --accent-green: #34c759;
            --accent-orange: #ff9500;
            --accent-purple: #af52de;
            --nav-height: 75px;
        }

        body {
            margin: 0; padding: 15px;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            background-color: var(--bg-color); color: var(--text-main);
            padding-bottom: calc(var(--nav-height) + 20px);
        }

        /* --- é¡¶éƒ¨åè¨€ --- */
        .quote-banner {
            background: linear-gradient(135deg, #2c3e50 0%, #4ca1af 100%);
            color: white; padding: 18px; border-radius: 18px;
            margin-bottom: 15px; text-align: center; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .quote-text { font-size: 15px; font-weight: 600; line-height: 1.4; }

        .page { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .page.active { display: block; opacity: 1; }

        /* --- å¸ƒå±€ç³»ç»Ÿ --- */
        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .full-width { grid-column: span 2; }

        .card {
            background: var(--card-bg); border-radius: 20px; padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
            display: flex; flex-direction: column; position: relative;
        }
        .card-header {
            font-size: 12px; font-weight: 700; color: var(--text-sub);
            margin-bottom: 12px; display: flex; align-items: center; gap: 5px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        /* --- å‘¨æ‰“å¡æ ·å¼ --- */
        .habit-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 8px 0; border-bottom: 1px solid #f2f2f7;
        }
        .habit-info { font-size: 14px; font-weight: 600; width: 100px; }
        .week-dots { display: flex; gap: 6px; flex: 1; justify-content: flex-end; }
        .dot {
            width: 30px; height: 30px; border-radius: 50%; border: 1.5px solid #e5e5ea;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: 700; color: #aeaeb2; cursor: pointer;
            transition: all 0.2s; background: white;
        }
        .dot.active-day { border-color: var(--text-main); border-width: 2px; color: var(--text-main); }
        .dot.done { background: var(--accent-green); border-color: var(--accent-green); color: white; }

        /* --- è®¡æ—¶å™¨ä¸ç¬”è®° --- */
        .timer-display { font-size: 32px; font-weight: 800; text-align: center; margin: 10px 0; font-variant-numeric: tabular-nums; }
        .small-select { font-size: 13px; padding: 8px; border-radius: 10px; background: #f2f2f7; border: none; width: 100%; }
        
        /* --- ç¿»è¯‘åŠ©æ‰‹å¢å¼º --- */
        .trans-textarea { height: 60px; font-size: 14px; padding: 10px; border-radius: 12px; background: #f2f2f7; border: none; resize: none; width: 100%; box-sizing: border-box; }
        .trans-actions { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-top: 8px; }
        .trans-btn { 
            padding: 8px; border-radius: 8px; border: none; color: white; font-size: 12px; font-weight: 600; cursor: pointer;
            background: var(--accent-blue);
        }
        .trans-result { 
            margin-top: 10px; padding: 10px; border-radius: 10px; background: #f0f7ff; 
            font-size: 13px; color: #004e9a; line-height: 1.4; min-height: 40px; border-left: 3px solid var(--accent-blue);
        }

        /* --- åº•éƒ¨å¯¼èˆª --- */
        .nav-bar {
            position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%);
            width: 85%; max-width: 380px; height: 65px;
            background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 25px; display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); z-index: 9999;
        }
        .nav-item { text-align: center; color: #bbb; font-size: 11px; font-weight: 600; cursor: pointer; }
        .nav-item.active { color: var(--accent-blue); }
        .nav-icon { font-size: 20px; display: block; margin-bottom: 2px; }

        .btn-action { background: var(--accent-orange); color: white; border: none; padding: 10px; border-radius: 10px; font-weight: 700; width: 100%; }

        @media (max-width: 350px) { .habit-info { font-size: 12px; width: 70px; } .dot { width: 25px; height: 25px; } }
    </style>
</head>
<body>

    <div class="quote-banner" onclick="refreshQuote()">
        <div class="quote-text" id="dailyQuote">"Done is better than perfect."</div>
    </div>

    <div id="page-home" class="page active">
        <div class="grid-container">
            
            <div class="card full-width" style="border-top: 4px solid var(--accent-green)">
                <div class="card-header">ğŸ“… Weekly Habits <span id="currentWeekRange" style="margin-left:auto; font-weight:normal; opacity:0.6"></span></div>
                <div id="habitContainer">
                    </div>
            </div>

            <div class="card" style="border-top: 4px solid var(--accent-orange); height: 240px;">
                <div class="card-header">â±ï¸ Focus</div>
                <select id="timerCategory" class="small-select">
                    <option value="ğŸ’¼ å·¥ä½œ">ğŸ’¼ å·¥ä½œ</option>
                    <option value="ğŸ“š å­¦ä¹ ">ğŸ“š å­¦ä¹ </option>
                    <option value="ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ äº²å­">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ äº²å­</option>
                    <option value="ğŸ® å¨±ä¹">ğŸ® å¨±ä¹</option>
                </select>
                <div class="timer-display" id="timerDisplay">00:00</div>
                <button class="btn-action" id="timerBtn" onclick="toggleTimer()">Start</button>
            </div>

            <div class="card" style="border-top: 4px solid var(--accent-purple); height: 240px;">
                <div class="card-header">ğŸ“ Notes</div>
                <textarea id="noteInput" placeholder="Quick idea..." style="flex:1; border:none; background:#f9f9fb; border-radius:10px; padding:8px; font-size:14px; resize:none;" oninput="autoSaveNote()"></textarea>
                <button onclick="saveNote()" style="margin-top:8px; background:var(--accent-purple); color:white; border:none; border-radius:8px; padding:6px; font-size:12px; font-weight:600;">Save</button>
            </div>

            <div class="card full-width" style="border-top: 4px solid var(--accent-blue)">
                <div class="card-header">ğŸŒ Professional Translator (CN â†’ EN)</div>
                <textarea id="transInput" class="trans-textarea" placeholder="è¾“å…¥ä¸­æ–‡æƒ³æ³•..."></textarea>
                <div class="trans-actions">
                    <button class="trans-btn" onclick="doTrans('oral')">â˜• å£è¯­</button>
                    <button class="trans-btn" style="background:#5856d6" onclick="doTrans('email')">ğŸ“§ é‚®ä»¶</button>
                    <button class="trans-btn" style="background:#1c1c1e" onclick="doTrans('presentation')">ğŸ“Š æ¼”ç¤º</button>
                </div>
                <div id="transResult" class="trans-result">ç¿»è¯‘ç»“æœå°†åœ¨æ­¤æ˜¾ç¤º...</div>
            </div>

        </div>
    </div>

    <div id="page-stats" class="page">
        <div class="card full-width">
            <div class="card-header">ğŸ“Š Focus Distribution</div>
            <canvas id="pieChart" style="max-height: 250px;"></canvas>
        </div>
        <div class="card full-width" style="margin-top:15px">
            <div class="card-header">ğŸ“ˆ Weekly Activity</div>
            <canvas id="barChart" style="max-height: 250px;"></canvas>
        </div>
    </div>

    <div id="page-library" class="page">
        <div class="card full-width" style="background: #fff0f6; border:none;">
            <div class="card-header" style="color:#d52b1e">âœ¨ Random Recall</div>
            <div id="recallContent" style="font-size:16px; font-weight:600; min-height:60px;">è®°å½•æ˜¯æ€è€ƒçš„å¼€å§‹ã€‚</div>
        </div>
        <div id="fullLogList" style="margin-top:15px;"></div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="switchPage('home', this)"><span class="nav-icon">ğŸ </span>Home</div>
        <div class="nav-item" onclick="switchPage('stats', this)"><span class="nav-icon">ğŸ“Š</span>Stats</div>
        <div class="nav-item" onclick="switchPage('library', this)"><span class="nav-icon">ğŸ“š</span>Library</div>
        <div class="nav-item" onclick="setApiKey()"><span class="nav-icon">âš™ï¸</span>Key</div>
    </div>

<script>
    // --- 1. é…ç½®ä¸ä¹ æƒ¯æ•°æ® ---
    const HABIT_NAMES = ["å¤šå–æ°´ ğŸ’§", "è¿åŠ¨30min ğŸƒ", "æŠ—ç³–é¥®é£Ÿ ğŸ¬", "æç®€è¡¨è¾¾ ğŸ—£ï¸", "å¿«é€Ÿè¡ŒåŠ¨ âš¡"];
    const WEEK_DAYS = ["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "æ—¥"];
    
    // è·å–æœ¬å‘¨ä¸€çš„æ—¥æœŸå­—ç¬¦ä¸²ä½œä¸º Key
    function getWeekKey() {
        const d = new Date();
        const day = d.getDay(), diff = d.getDate() - day + (day == 0 ? -6 : 1);
        const monday = new Date(d.setDate(diff));
        return monday.toISOString().split('T')[0];
    }

    let habitData = JSON.parse(localStorage.getItem('habits_v6') || '{}');
    const currentWeekKey = getWeekKey();
    if(!habitData[currentWeekKey]) habitData[currentWeekKey] = HABIT_NAMES.map(() => Array(7).fill(false));

    function renderHabitUI() {
        const container = document.getElementById('habitContainer');
        const todayIdx = (new Date().getDay() + 6) % 7; // 0 æ˜¯å‘¨ä¸€
        container.innerHTML = HABIT_NAMES.map((name, hIdx) => `
            <div class="habit-row">
                <div class="habit-info">${name}</div>
                <div class="week-dots">
                    ${WEEK_DAYS.map((label, dIdx) => {
                        const isDone = habitData[currentWeekKey][hIdx][dIdx];
                        const isToday = dIdx === todayIdx;
                        return `<div class="dot ${isDone?'done':''} ${isToday?'active-day':''}" onclick="toggleDot(${hIdx}, ${dIdx})">${isDone?'âœ“':label}</div>`;
                    }).join('')}
                </div>
            </div>
        `).join('');
    }

    function toggleDot(hIdx, dIdx) {
        habitData[currentWeekKey][hIdx][dIdx] = !habitData[currentWeekKey][hIdx][dIdx];
        localStorage.setItem('habits_v6', JSON.stringify(habitData));
        renderHabitUI();
        if(navigator.vibrate) navigator.vibrate(40);
    }
    renderHabitUI();

    // --- 2. è®¡æ—¶å™¨é€»è¾‘ ---
    let tInterval = null;
    let tState = JSON.parse(localStorage.getItem('t_state_v6') || '{"active":false}');

    function toggleTimer() {
        if(!tState.active) {
            tState = { active: true, start: Date.now(), cat: document.getElementById('timerCategory').value };
            tInterval = setInterval(updateTUI, 1000);
            document.getElementById('timerBtn').innerText = "Stop";
            document.getElementById('timerBtn').style.background = "#ff3b30";
        } else {
            clearInterval(tInterval);
            const dur = Date.now() - tState.start;
            saveTRecord(tState.cat, dur);
            tState = { active: false };
            document.getElementById('timerBtn').innerText = "Start";
            document.getElementById('timerBtn').style.background = "var(--accent-orange)";
            document.getElementById('timerDisplay').innerText = "00:00";
        }
        localStorage.setItem('t_state_v6', JSON.stringify(tState));
    }

    function updateTUI() {
        const sec = Math.floor((Date.now() - tState.start) / 1000);
        const m = Math.floor(sec/60).toString().padStart(2,'0');
        const s = (sec%60).toString().padStart(2,'0');
        document.getElementById('timerDisplay').innerText = `${m}:${s}`;
    }
    if(tState.active) { tInterval = setInterval(updateTUI, 1000); document.getElementById('timerBtn').innerText = "Stop"; document.getElementById('timerBtn').style.background = "#ff3b30"; }

    function saveTRecord(c, ms) {
        const logs = JSON.parse(localStorage.getItem('t_logs_v6') || '[]');
        logs.push({c, ms, d: new Date().toISOString()});
        localStorage.setItem('t_logs_v6', JSON.stringify(logs));
    }

    // --- 3. ç¿»è¯‘åŠ©æ‰‹ (æ ¸å¿ƒé€»è¾‘å‡çº§) ---
    async function doTrans(type) {
        const input = document.getElementById('transInput').value.trim();
        const key = localStorage.getItem('dk_v6');
        if(!input || !key) return alert("è¯·è¾“å…¥å†…å®¹æˆ–è®¾ç½® Key");
        
        const resBox = document.getElementById('transResult');
        resBox.innerText = "Polishing your English...";

        const systemPrompts = {
            oral: "ä½ æ˜¯ä¸€ä¸ªåœ°é“çš„è‹±è¯­æ¯è¯­è€…ã€‚è¯·å°†ç”¨æˆ·çš„ä¸­æ–‡å£è¯­ç¿»è¯‘æˆèŒåœºæ²Ÿé€šä¸­åœ°é“ã€è‡ªç„¶çš„è¡¨è¾¾ï¼Œä¸è¦ç¿»è¯‘è…”ï¼Œè¦åƒå¤–ä¼å‘˜å·¥èŒ¶æ­‡æˆ–å¼€ä¼šæ—¶çš„è¡¨è¾¾ã€‚",
            email: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å•†åŠ¡è‹±è¯­ä¸“å®¶ã€‚è¯·å°†ç”¨æˆ·çš„æ„æ€è½¬åŒ–ä¸ºæ­£å¼ã€å¾—ä½“ã€ç¤¼è²Œçš„å•†åŠ¡é‚®ä»¶å†…å®¹ï¼Œä½¿ç”¨ä¸“ä¸šçš„å¸¸ç”¨å¤–ä¼å¥å¼ã€‚",
            presentation: "ä½ æ˜¯ä¸€ä¸ªé¡¶å°–çš„å•†ä¸šæ¼”è¯´å®¶ã€‚è¯·å°†ç”¨æˆ·çš„è§‚ç‚¹è½¬åŒ–ä¸ºåœ¨ PPT æˆ–æ±‡æŠ¥ä¸­ä½¿ç”¨çš„è¡¨è¾¾ï¼Œè¦ç®€æ´ã€æœ‰åŠ›ï¼ˆPowerfulï¼‰ã€å¤šç”¨åŠ¨è¯ï¼Œå…·æœ‰æ„ŸæŸ“åŠ›ã€‚"
        };

        try {
            const response = await fetch("https://api.deepseek.com/chat/completions", {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${key}` },
                body: JSON.stringify({
                    model: "deepseek-chat",
                    messages: [
                        { role: "system", content: systemPrompts[type] },
                        { role: "user", content: `è¯·ç¿»è¯‘è¿™æ®µè¯ï¼š${input}` }
                    ]
                })
            });
            const data = await response.json();
            resBox.innerText = data.choices[0].message.content;
        } catch (e) { resBox.innerText = "Error: æ— æ³•è¿æ¥ API"; }
    }

    // --- 4. ç¬”è®°ä¸é€šç”¨ ---
    function saveNote() {
        const val = document.getElementById('noteInput').value.trim();
        if(!val) return;
        const logs = JSON.parse(localStorage.getItem('n_logs_v6') || '[]');
        logs.unshift({c: val, d: new Date().toLocaleString()});
        localStorage.setItem('n_logs_v6', JSON.stringify(logs));
        document.getElementById('noteInput').value = "";
        alert("Saved!");
    }

    function switchPage(p, el) {
        document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
        document.getElementById('page-'+p).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        el.classList.add('active');
        if(p === 'stats') renderCharts();
        if(p === 'library') renderLibrary();
    }

    function setApiKey() {
        const k = prompt("Enter DeepSeek API Key:", localStorage.getItem('dk_v6') || "");
        if(k) localStorage.setItem('dk_v6', k.trim());
    }

    const quotes = [
        "Focus on being productive instead of busy.",
        "Your direction is more important than your speed.",
        "Simplify, then add lightness.",
        "The secret of getting ahead is getting started.",
        "Professionalism is the art of getting it done."
    ];
    function refreshQuote() { document.getElementById('dailyQuote').innerText = `"${quotes[Math.floor(Math.random()*quotes.length)]}"`; }

    // --- 5. å›¾è¡¨ ---
    let pChart, bChart;
    function renderCharts() {
        const logs = JSON.parse(localStorage.getItem('t_logs_v6') || '[]');
        const cats = {}; logs.forEach(l => { cats[l.c] = (cats[l.c]||0) + l.ms; });
        
        if(pChart) pChart.destroy();
        pChart = new Chart(document.getElementById('pieChart'), {
            type: 'doughnut',
            data: { labels: Object.keys(cats), datasets: [{ data: Object.values(cats).map(v=>v/60000), backgroundColor: ['#ff9500','#007aff','#34c759','#af52de'] }] }
        });
    }

    function renderLibrary() {
        const notes = JSON.parse(localStorage.getItem('n_logs_v6') || '[]');
        document.getElementById('fullLogList').innerHTML = notes.map(n => `<div class="card" style="margin-bottom:10px; font-size:14px;">${n.c}<div style="font-size:10px; color:#aaa; margin-top:5px;">${n.d}</div></div>`).join('');
        if(notes.length > 0) document.getElementById('recallContent').innerText = notes[Math.floor(Math.random()*notes.length)].c;
    }
</script>
</body>
</html>